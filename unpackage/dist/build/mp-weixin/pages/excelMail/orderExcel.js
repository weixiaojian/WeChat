(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/excelMail/orderExcel"],{"163f":function(e,t,i){"use strict";var o=i("71b3"),s=i.n(o);s.a},5129:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){i.e("pages/order/components/agreement/index").then(function(){return resolve(i("7347"))}.bind(null,i)).catch(i.oe)},s=null,a={components:{Agreement:o},data:function(){return{orderList:[],agree:!0,listMail:{},newaddressId:"",editRecIndex:0,mockList:this.$Mock.payment_type,typeList:this.$Mock.product_type,payment_type:"现金",currentId:"",batchList:[],batchIndex:0,teamModel:"",userData:{},disable:!1,productType:"",isProductType:!1}},onLoad:function(e){var t=this,i=JSON.parse(e.order);this.currentId=e.pageId,"excel"==e.pageId?(console.log("order",i),i.forEach((function(e,t){e.packingPiece=1,e.goodsType="",e.acceptManCompany=""})),this.orderList=i):(i.forEach((function(e,t){e.packingPiece=1,e.acceptManCompany="",e.weight=1,e.goodsName="文件",e.goodsType=""})),this.batchList=i);var o=this.$getStorageSync("userData");try{this.userData=JSON.parse(o)}catch(s){console.log(s)}t.teamModel="1"==t.$getStorageSync("teamModel")?"1":"2",wx.setNavigationBarTitle({title:"下单寄件".concat("1"===t.$getStorageSync("teamModel")?"（团队）":"")}),this.setTeamInfo(),("1"==t.teamModel||t.userData.customerCode)&&t.getBlProductType()},mounted:function(){var t=this;e.$on("selectAddress",(function(e){e&&(t.listMail=e)})),e.$on("inputAddress",(function(e){"jjr"==t.newaddressId?t.listMail=e:"sjr"==t.newaddressId&&("excel"==t.currentId?(t.orderList[t.editRecIndex].address=e.detailAddress,t.orderList[t.editRecIndex].city=e.city,t.orderList[t.editRecIndex].county=e.country,t.orderList[t.editRecIndex].fromAddress=e.provice+e.city+e.country+e.townName+e.detailAddress,t.orderList[t.editRecIndex].name=e.name,t.orderList[t.editRecIndex].phone=e.phone,t.orderList[t.editRecIndex].town=e.townName,t.orderList[t.editRecIndex].province=e.provice,t.orderList[t.editRecIndex].acceptManCompany=e.company):(t.batchList[t.batchIndex].formatAddress=e.detailAddress,t.batchList[t.batchIndex].cityName=e.city,t.batchList[t.batchIndex].countyName=e.country,t.batchList[t.batchIndex].reqAddress="".concat(e.name,"，").concat(e.phone,"，").concat(e.provice).concat(e.city).concat(e.country).concat(e.townName).concat(e.detailAddress),t.batchList[t.batchIndex].name=e.name,t.batchList[t.batchIndex].phone=e.phone,t.batchList[t.batchIndex].townName=e.townName,t.batchList[t.batchIndex].province=e.provice,t.batchList[t.batchIndex].acceptManCompany=e.company))})),e.$on("packageinfo",(function(e){console.log("info",e.packingPiece),"excel"==t.currentId?(e.allSelect?t.orderList.forEach((function(t){t.weight=e.goodsWeight,t.goodsName=e.goodsName,t.goodsType=e.goodsType,t.packingPiece=e.packingPiece,t.remark=e.remark})):(t.orderList[t.editRecIndex].weight=e.goodsWeight,t.orderList[t.editRecIndex].goodsName=e.goodsName,t.orderList[t.editRecIndex].goodsType=e.goodsType,t.orderList[t.editRecIndex].packingPiece=e.packingPiece,t.orderList[t.editRecIndex].remark=e.remark),console.log(t.orderList)):e.allSelect?t.batchList.forEach((function(t){t.weight=e.goodsWeight,t.goodsName=e.goodsName,t.goodsType=e.goodsType,t.packingPiece=e.packingPiece,t.remark=e.remark})):(t.batchList[t.batchIndex].weight=e.goodsWeight,t.batchList[t.batchIndex].goodsName=e.goodsName,t.batchList[t.batchIndex].goodsType=e.goodsType,t.batchList[t.batchIndex].packingPiece=e.packingPiece,t.batchList[t.batchIndex].remark=e.remark)})),this.$nextTick((function(){console.log(this.userData.customerCode),"1"!=this.teamModel&&this.userData.customerCode&&(this.payment_type="月结")}))},onShow:function(){(this.orderList.length>0||this.batchList.length>0)&&this.checkDispByCity()},onUnload:function(){e.$off("selectAddress"),e.$off("inputAddress"),e.$off("packageinfo")},methods:{setTeamInfo:function(){var t=this,i=t.$getStorageSync("teamInfo");console.log("teamInfo",i);var o=!!i&&i.groupId;if("1"!=t.teamModel&&!t.userData.customerCode)return o?(e.showModal({title:"提示",content:"请选择团队模式下单",showCancel:!1,success:function(i){i.confirm?e.switchTab({url:"/pages/tabbar/home/index?pageId=send"}):i.cancel&&(t.disable=!0)}}),!1):(e.showModal({title:"提示",content:"散客不支持下单，请联系021-39209005或绑定月结客户编码再下单。",confirmText:"去绑定",showCancel:!1,success:function(i){i.confirm?e.navigateTo({url:"/pages/bind-monthly/index?pageId=send"}):i.cancel&&(e.switchTab({url:"/pages/tabbar/home/index?pageId=send"}),t.disable=!0)}}),!1)},getBlProductType:function(){var e=this,t=e.$getStorageSync("teamInfo"),i={type:"1"==e.teamModel?1:0,code:"1"==e.teamModel?t.siteCode:e.userData.customerCode};e.$api.getBlProductType(i).then((function(t){console.log("getBlProductType",t),200==t.code&&(e.isProductType=!0,e.productType="当日件")}))},productTypeChange:function(e){var t=e.detail.value;"excel"==this.currentId?this.orderList[e.currentTarget.dataset.index].productType=this.$Mock.product_type[t].name:this.batchList[e.currentTarget.dataset.index].productType=this.$Mock.product_type[t].name,this.productType=this.$Mock.product_type[t].name},getNewAddress:function(t,i){var o={type:"send"};this.newaddressId=t,"jjr"==t?(o.item=this.listMail,o.isEdit=!!this.listMail.name):("excel"==this.currentId?(o.item={name:this.orderList[i].name,phone:this.orderList[i].phone,provice:this.orderList[i].province,city:this.orderList[i].city,country:this.orderList[i].county,detailAddress:this.orderList[i].address,townName:this.orderList[i].town,company:this.orderList[i].acceptManCompany},this.editRecIndex=i,o.isEdit=!!this.orderList[i].name):"batch"==this.currentId&&(o.item={name:this.batchList[i].name,phone:this.batchList[i].phone,provice:this.batchList[i].province,city:this.batchList[i].cityName,country:this.batchList[i].countyName,detailAddress:this.batchList[i].formatAddress,townName:this.batchList[i].townName,company:this.batchList[i].acceptManCompany},this.batchIndex=i,o.isEdit=!!this.batchList[i].name),this.checkDispByCity()),e.navigateTo({url:"/pages/newaddress/index?pageId="+t+"&data="+JSON.stringify(o)})},myaddress:function(t){var i={tabIndex:t};e.navigateTo({url:"/pages/myaddress/index?pageId=send&data="+JSON.stringify(i)})},detele:function(t,i){var o=this;e.showModal({title:"移除提示",content:"您确定要移除"+t.name+"的信息？",success:function(e){e.confirm&&("excel"==o.currentId?o.orderList.splice(i,1):o.batchList.splice(i,1))}})},changeShop:function(t,i){var o={};o.type=t,"wpxx"==t&&("excel"==this.currentId?(this.editRecIndex=i,o.item={goodsName:this.orderList[i].goodsName,remark:this.orderList[i].remark,goodsWeight:this.orderList[i].weight,packingPiece:this.orderList[i].packingPiece}):(this.batchIndex=i,o.item={goodsName:this.batchList[i].goodsName,remark:this.batchList[i].remark,goodsWeight:this.batchList[i].weight,packingPiece:this.batchList[i].packingPiece}),e.navigateTo({url:"/pages/order/packageinfo/index?pageId=sends&data="+JSON.stringify(o)}))},checkboxChange:function(e){this.agree="agree"==e.detail.value},bindPickerChange:function(e){var t=e.detail.value;this.payment_type=this.$Mock.payment_type[t].name,console.log(this.payment_type)},checkDispByCity:function(){var e=this;"excel"==this.currentId?this.orderList.forEach((function(t,i){var o={city:t.address.city};t.disable=!1,e.$api.checkDispByCity(o).then((function(e){400==e.code&&(t.disable=!0)}))})):"batch"==this.currentId&&this.batchList.forEach((function(t,i){var o={city:t.address.city};t.disable=!1,e.$api.checkDispByCity(o).then((function(e){400==e.code&&(t.disable=!0)}))}))},goRead:function(){this.$refs["showpopup1"].open()},confirmAgreement:function(){var e=this;e.$refs["showpopup1"].close(),e.agree=!0},ChangeBtn:function(){var t=this,i=this;if(!i.disable){var o=this.$getStorageSync("teamInfo");if("{}"!=JSON.stringify(this.listMail))if(this.agree){var a={},n=[];if("excel"==this.currentId){if(!this.orderList.length)return void e.showToast({icon:"none",title:"收件信息请补充",duration:3e3});for(var c=0;c<this.orderList.length;c++)if(!this.orderList[c].disable){if(""==this.orderList[c].name||void 0==this.orderList[c].name||null==this.orderList[c].name)return void e.showToast({icon:"none",title:"请填写第"+(c+1)+"个收件人信息",duration:2e3});if(""==this.orderList[c].weight)return void e.showToast({icon:"none",title:"请填写第"+(c+1)+"个重量信息",duration:2e3});if(""==this.orderList[c].goodsName)return void e.showToast({icon:"none",title:"请填写第"+(c+1)+"个物品名称",duration:2e3});if(""==this.orderList[c].weight)return void e.showToast({icon:"none",title:"请填写第"+(c+1)+"个数量",duration:2e3});if(""==this.orderList[c].productType&&this.isProductType)return void e.showToast({icon:"none",title:"请填写第"+(c+1)+"产品类型",duration:2e3});a={sendCountry:"中国",sendProvince:this.listMail.provice,sendCity:this.listMail.city,sendCounty:this.listMail.country,sendTown:this.listMail.townName,sendManAddress:this.listMail.detailAddress,sendMan:this.listMail.name,sendManMobile:this.listMail.phone,sendManCompany:this.listMail.company,sendSite:"",sendSiteCode:"",acceptCountry:"中国",acceptProvince:this.orderList[c].province,acceptCity:this.orderList[c].city,acceptCounty:this.orderList[c].county,acceptTown:this.orderList[c].town,acceptManAddress:this.orderList[c].address,acceptMan:this.orderList[c].name,acceptManMobile:this.orderList[c].phone,acceptManCompany:this.orderList[c].acceptManCompany,storageType:this.orderList[c].storageType,packingPiece:this.orderList[c].packingPiece,openId:this.$getStorageSync("token"),freight:0,remark:this.orderList[c].remark,recManCode:"",goodsWeight:this.orderList[c].weight,paymentType:this.payment_type,productType:this.productType,originalBillCode:"",goodsName:this.orderList[c].goodsName,goodsPayment:0,dataFrom:"微信",recMan:"",goodsType:this.orderList[c].goodsType},"1"==this.teamModel?(a.groupId=o.groupId,a.groupMember=o.nickName,a.sendSite=o.siteName,a.sendSiteCode=o.siteCode,a.customerCode=o.customerCode,a.customerName=o.customerName):this.userData.customerCode&&(a.customerCode=this.userData.customerCode,a.customerName=this.userData.customerName),n.push(a)}}else{if(!this.batchList.length)return void e.showToast({icon:"none",title:"收件信息请补充",duration:3e3});for(var r=0;r<this.batchList.length;r++)if(!this.batchList[r].disable){if(""==this.batchList[r].name||void 0==this.batchList[r].name||null==this.batchList[r].name)return void e.showToast({icon:"none",title:"请填写第"+(r+1)+"个收件人信息",duration:2e3});if(""==this.batchList[r].weight)return void e.showToast({icon:"none",title:"请填写第"+(r+1)+"个重量信息",duration:2e3});if(""==this.batchList[r].goodsName)return void e.showToast({icon:"none",title:"请填写第"+(r+1)+"个物品名称",duration:2e3});if(""==this.batchList[r].packingPiece)return void e.showToast({icon:"none",title:"请填写第"+(r+1)+"个数量",duration:2e3});if(""==this.batchList[r].productType&&this.isProductType)return void e.showToast({icon:"none",title:"请填写第"+(r+1)+"产品类型",duration:2e3});a={sendCountry:"中国",sendProvince:this.listMail.provice,sendCity:this.listMail.city,sendCounty:this.listMail.country,sendTown:this.listMail.townName,sendManAddress:this.listMail.detailAddress,sendMan:this.listMail.name,sendManMobile:this.listMail.phone,sendManCompany:this.listMail.company,sendSite:"",sendSiteCode:"",acceptCountry:"中国",acceptProvince:this.batchList[r].province,acceptCity:this.batchList[r].cityName,acceptCounty:this.batchList[r].countyName,acceptTown:this.batchList[r].townName,acceptManAddress:this.$Reg.stripscript(this.batchList[r].formatAddress),acceptMan:this.batchList[r].name,acceptManMobile:this.batchList[r].phone,acceptManCompany:this.batchList[r].acceptManCompany,packingPiece:this.batchList[r].packingPiece,openId:this.$getStorageSync("token"),freight:0,remark:this.batchList[r].remark,recManCode:"",goodsWeight:this.batchList[r].weight,paymentType:this.payment_type,productType:this.productType,originalBillCode:"",goodsName:this.batchList[r].goodsName,goodsPayment:0,dataFrom:"微信",recMan:"",goodsType:this.batchList[r].goodsType},"1"==this.teamModel?(a.groupId=o.groupId,a.groupMember=o.nickName,a.sendSite=o.siteName,a.sendSiteCode=o.siteCode,a.customerCode=o.customerCode,a.customerName=o.customerName):this.userData.customerCode&&(a.customerCode=this.userData.customerCode,a.customerName=this.userData.customerName),n.push(a)}}console.log("形成的批量订单",n),null!=s&&clearTimeout(s),s=setTimeout((function(){0!=n.length&&(e.showLoading({title:"正在下单,请等待"}),t.$api.saveOrderList(n).then((function(i){if(setTimeout((function(){e.hideLoading()}),2e3),console.log("正在下单,请等待",i),200==i.code)if(e.showToast({icon:"none",title:"成功了:"+i.data.successTotal+"条，失败了:"+i.data.errorTotal,duration:2e3}),i.data.errorList.length>0){var o=i.data.errorList;"excel"==t.currentId?(o.forEach((function(e,t){e.weight=e.goodsWeight||"",e.name=e.acceptMan||"",e.phone=e.acceptManMobile||"",e.province=e.acceptProvince||"",e.city=e.acceptCity||"",e.county=e.acceptCounty||"",e.town=e.acceptTown||"",e.address=e.acceptManAddress||"",e.packingPiece=e.packingPiece||""})),t.orderList=o):(o.forEach((function(e,t){e.weight=e.goodsWeight||"",e.name=e.acceptMan||"",e.phone=e.acceptManMobile||"",e.province=e.acceptProvince||"",e.cityName=e.acceptCity||"",e.countyName=e.acceptCounty||"",e.townName=e.acceptTown||"",e.formatAddress=e.acceptManAddress||"",e.packingPiece=e.packingPiece||""})),t.batchList=o)}else setTimeout((function(){getApp().globalData.currentIndex=0,e.switchTab({url:"/pages/tabbar/inquire/index"})}),2e3)})))}),1e3)}else e.showToast({icon:"none",title:"勾选运单寄件协议",duration:3e3});else e.showToast({icon:"none",title:"寄件信息请补充",duration:3e3})}}}};t.default=a}).call(this,i("543d")["default"])},"71b3":function(e,t,i){},a861:function(e,t,i){"use strict";i.r(t);var o=i("5129"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,(function(){return o[e]}))}(a);t["default"]=s.a},d712:function(e,t,i){"use strict";i.r(t);var o=i("eb77"),s=i("a861");for(var a in s)"default"!==a&&function(e){i.d(t,e,(function(){return s[e]}))}(a);i("163f");var n,c=i("f0c5"),r=Object(c["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],n);t["default"]=r.exports},e514:function(e,t,i){"use strict";(function(e){i("5e56");o(i("66fd"));var t=o(i("d712"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=i,e(t.default)}).call(this,i("543d")["createPage"])},eb77:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return o}));var o={uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"e88b"))}},s=function(){var e=this,t=e.$createElement;e._self._c},a=[]}},[["e514","common/runtime","common/vendor"]]]);