(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/batch-send/index"],{"2a84":function(e,a,t){"use strict";(function(e){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var s=function(){t.e("pages/order/components/agreement/index").then(function(){return resolve(t("7347"))}.bind(null,t)).catch(t.oe)},o=function(){t.e("components/yd-toast/yd-toast").then(function(){return resolve(t("85a2"))}.bind(null,t)).catch(t.oe)},d=null,n={data:function(){return{addressDataJJ:{},addressDataSJ:[],addressDataSJCopy:[],editRecIndex:0,freight:"",agree:!0,pageId:"",realName:!1,optionType:"",newaddressId:"",tabIndex:0,specEmployee:"",specEmployeeCode:"",payment_type:"现金",mockList:this.$Mock.payment_type,typeList:this.$Mock.product_type,teamModel:"",userData:{},disable:!1,productType:"",isProductType:!1,backBatch:!0}},mounted:function(){var a=this,t=this;e.$on("selectAddress",(function(e){if(console.log(t.addressDataSJ),"0"==a.tabIndex)a.addressDataJJ=e,a.blurValue();else if("1"==a.tabIndex){var s=e;s.forEach((function(e){var s={};s.address=e,s.goodsInfo={goodsWeight:1,goodsName:"其他类型",goodsType:"",packingPiece:1,remark:"",goodsPayment:"现金",productType:a.isProductType?"当日件":""},t.addressDataSJ.push(s)})),t.checkDispByCity()}})),e.$on("packageinfo",(function(e){e.allSelect?(console.log("info",e.allSelect),a.addressDataSJ.forEach((function(a){a.goodsInfo.goodsWeight=e.goodsWeight,a.goodsInfo.goodsName=e.goodsName,a.goodsInfo.goodsType=e.goodsType,a.goodsInfo.packingPiece=e.packingPiece,a.goodsInfo.remark=e.remark}))):(a.addressDataSJ[a.editRecIndex].goodsInfo.goodsWeight=e.goodsWeight,a.addressDataSJ[a.editRecIndex].goodsInfo.goodsName=e.goodsName,a.addressDataSJ[a.editRecIndex].goodsInfo.goodsType=e.goodsType,a.addressDataSJ[a.editRecIndex].goodsInfo.packingPiece=e.packingPiece,a.addressDataSJ[a.editRecIndex].goodsInfo.remark=e.remark)})),e.$on("inputAddress",(function(e){"jjr"==a.newaddressId?t.addressDataJJ=e:"sjr"==a.newaddressId&&(t.addressDataSJ[a.editRecIndex].address=e,t.addressDataSJ[a.editRecIndex].noPerfect=!1)})),e.$on("batchRec",(function(e){a.backBatch=!1,a.echoRecDataByParsing(e)})),this.backBatch&&this.echoOrderData(),this.$nextTick((function(){console.log(this.userData.customerCode),"1"!=this.teamModel&&this.userData.customerCode&&(this.payment_type="月结")}))},components:{Agreement:s,YDTOAST:o},beforeDestroy:function(){this.setStorageData()},onShow:function(){var e,a,t=this;this.addressDataJJ.phone&&t.blurValue();try{e=JSON.parse(this.$getStorageSync("sendsOrder"))}catch(s){console.log(s)}a=!e||0==Object.keys(e.addressDataJJ).length,0==Object.keys(this.addressDataJJ).length&&a&&t.getAddressDefault(),this.addressDataSJ.length>0&&t.checkDispByCity()},onLoad:function(a){var t=this,s=t.$getStorageSync("userData");if("undefined"==typeof s)return e.showModal({title:"提示",content:"请先登录授权~",success:function(a){a.confirm&&e.switchTab({url:"/pages/tabbar/my/index?pageId=send"})}}),!1;try{this.userData=JSON.parse(s)}catch(o){console.log(o)}t.teamModel="1"==t.$getStorageSync("teamModel")?"1":"2",wx.setNavigationBarTitle({title:"下单寄件".concat("1"===t.$getStorageSync("teamModel")?"（团队）":"")}),t.setTeamInfo(),("1"==t.teamModel||t.userData.customerCode)&&t.getBlProductType()},onUnload:function(){e.$off("selectAddress"),e.$off("packageinfo"),e.$off("addedservices"),e.$off("inputAddress"),e.$off("batchRec")},onHide:function(){this.setStorageData()},methods:{setTeamInfo:function(){var a=this,t=a.$getStorageSync("teamInfo");console.log("teamInfo",t);var s=!!t&&t.groupId;if("1"!=a.teamModel&&!a.userData.customerCode)return s?(e.showModal({title:"提示",content:"请选择团队模式下单",showCancel:!1,success:function(t){t.confirm?e.switchTab({url:"/pages/tabbar/home/index?pageId=send"}):t.cancel&&(a.disable=!0)}}),!1):(e.showModal({title:"提示",content:"散客不支持下单，请联系021-39209005或绑定月结客户编码再下单。",confirmText:"去绑定",showCancel:!1,success:function(t){t.confirm?e.navigateTo({url:"/pages/bind-monthly/index?pageId=send"}):t.cancel&&(e.switchTab({url:"/pages/tabbar/home/index?pageId=send"}),a.disable=!0)}}),!1)},echoRecDataByParsing:function(e){var a,t=this;console.log("order",e);var s=[];e.forEach((function(e,a){var o={goodsInfo:{goodsWeight:1,goodsName:"其他类型",goodsType:"",packingPiece:1,remark:"",goodsPayment:"现金",productType:t.isProductType?"当日件":""},address:{name:e.name||"",phone:e.phone||"",provice:e.province||"",city:e.cityName||"",country:e.countyName||"",townName:e.townName||"",detailAddress:e.formatAddress||""}};e.province&&e.cityName&&e.countyName&&e.formatAddress&&t.$Reg.RegTel(e.phone)||(o.noPerfect=!0),console.log("obj",o),s.push(o)})),this.addressDataSJ=(a=this.addressDataSJ).concat.apply(a,s)},goParsingBatch:function(){e.navigateTo({url:"/pages/parsing-batch/parsing-batch?pageId=sends"})},getBlProductType:function(){var e=this,a=e.$getStorageSync("teamInfo"),t={type:"1"==e.teamModel?1:0,code:"1"==e.teamModel?a.siteCode:e.userData.customerCode};e.$api.getBlProductType(t).then((function(a){console.log("getBlProductType",a),200==a.code&&(e.isProductType=!0,e.productType="当日件")}))},productTypeChange:function(e){var a=e.detail.value;this.addressDataSJ[e.currentTarget.dataset.index].goodsInfo.productType=this.$Mock.product_type[a].name},getGoodsInfo:function(a,t){this.editRecIndex=a;var s={};s.type=t,"wpxx"==t&&(s.item={goodsName:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsName,remark:this.addressDataSJ[this.editRecIndex].goodsInfo.remark,goodsWeight:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsWeight,packingPiece:this.addressDataSJ[this.editRecIndex].goodsInfo.packingPiece,goodsType:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsType},e.navigateTo({url:"/pages/order/packageinfo/index?pageId=sends&data="+JSON.stringify(s)}))},detele:function(a,t){var s=this;a.noPerfect?this.addressDataSJ.splice(t,1):e.showModal({title:"移除提示",content:"您确定要移除"+a.address.name+"的信息？",success:function(e){e.confirm&&s.addressDataSJ.splice(t,1)}})},goRead:function(){this.$refs["showpopup1"].open()},confirmAgreement:function(){var e=this;e.$refs["showpopup1"].close(),e.agree=!0},blurValue:function(){var e=this,a=!!this.addressDataJJ&&this.addressDataJJ.phone;if(a){var t={phone:this.addressDataJJ.phone};e.$getByPhone(t).then((function(a){console.log(a),e.realName=a,e.hasTips=!a}))}},checkDispByCity:function(){var e=this;this.addressDataSJ.forEach((function(a,t){var s={city:a.address.city};a.disable=!1,e.$api.checkDispByCity(s).then((function(e){400==e.code?a.disable=!0:200==e.code&&(a.disable=!1)}))}))},bindPickerChange:function(e){var a=e.detail.value;this.payment_type=this.$Mock.payment_type[a].name,console.log(this.payment_type)},realnameMethod:function(){var a={phone:this.addressDataJJ.phone};e.navigateTo({url:"/pages/myrealname/index?data="+JSON.stringify(a)})},getAddressDefault:function(){var e=this;e.$api.getAddressDefault().then((function(a){200==a.code&&null!=a.data&&(e.addressDataJJ=a.data)}))},checkboxChange:function(e){this.agree="agree"==e.detail.value,console.log(this.agree)},deleteRec:function(e){var a=this;a.addressDataSJ.splice(e,1)},newaddress:function(a,t){var s={type:"sends"};this.newaddressId=a,"jjr"==a?s.item=this.addressDataJJ:"sjr"==a&&(s.item=this.addressDataSJ[t].address,this.editRecIndex=t),e.navigateTo({url:"/pages/newaddress/index?pageId="+a+"&data="+JSON.stringify(s)})},submit:function(){var a=this,t=this;if(!t.disable){var s=this.addressDataSJ.some((function(e){return 1==e.noPerfect}));if(s)return e.showToast({icon:"none",title:"请完善地址信息",duration:2e3}),!1;var o=this.$getStorageSync("teamInfo");"{}"!=JSON.stringify(this.addressDataJJ)?this.addressDataSJ.length?this.agree?(null!=d&&clearTimeout(d),d=setTimeout((function(){for(var s={},d=[],n=0;n<a.addressDataSJ.length;n++)if(!a.addressDataSJ[n].disable){if(""==a.addressDataSJ[n].address.name||void 0==a.addressDataSJ[n].address.name||null==a.addressDataSJ[n].address.name)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个收件人信息",duration:2e3});if(""==a.addressDataSJ[n].goodsInfo.goodsWeight)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个重量信息",duration:2e3});if(""==a.addressDataSJ[n].goodsInfo.goodsName)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个物品名称",duration:2e3});if(""==a.addressDataSJ[n].goodsInfo.packingPiece)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个数量",duration:2e3});if(""==a.addressDataSJ[n].goodsInfo.productType&&a.isProductType)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"产品类型",duration:2e3});s={sendCountry:"中国",sendProvince:a.addressDataJJ.provice,sendCity:a.addressDataJJ.city,sendCounty:a.addressDataJJ.country,sendTown:a.addressDataJJ.townName,sendManAddress:a.addressDataJJ.detailAddress,sendMan:a.addressDataJJ.name,sendManMobile:a.addressDataJJ.phone,sendManCompany:a.addressDataJJ.company,sendSite:"",sendSiteCode:"",acceptCountry:"中国",acceptProvince:a.addressDataSJ[n].address.provice,acceptCity:a.addressDataSJ[n].address.city,acceptCounty:a.addressDataSJ[n].address.country,acceptTown:a.addressDataSJ[n].address.townName,acceptManAddress:a.addressDataSJ[n].address.detailAddress,acceptMan:a.addressDataSJ[n].address.name,acceptManMobile:a.addressDataSJ[n].address.phone,acceptManCompany:a.addressDataSJ[n].address.company,packingPiece:a.addressDataSJ[n].goodsInfo.packingPiece,openId:a.$getStorageSync("token"),freight:0,remark:a.addressDataSJ[n].goodsInfo.remark,recManCode:"",goodsWeight:a.addressDataSJ[n].goodsInfo.goodsWeight,paymentType:a.payment_type,productType:a.addressDataSJ[n].goodsInfo.productType,originalBillCode:"",goodsName:a.addressDataSJ[n].goodsInfo.goodsName,goodsPayment:0,dataFrom:"微信",recMan:"",goodsType:a.addressDataSJ[n].goodsInfo.goodsType},"1"==a.teamModel?(s.groupId=o.groupId,s.groupMember=o.nickName,s.sendSite=o.siteName,s.sendSiteCode=o.siteCode,s.customerCode=o.customerCode,s.customerName=o.customerName):a.userData.customerCode&&(s.customerCode=a.userData.customerCode,s.customerName=a.userData.customerName),d.push(s)}console.log("形成的批量订单",d),0!=d.length&&(e.showLoading({title:"正在下单,请等待"}),a.$api.saveOrderList(d).then((function(s){if(setTimeout((function(){e.hideLoading()}),2e3),console.log("正在下单,请等待",s),200==s.code)if(e.showToast({icon:"none",title:"成功了:"+s.data.successTotal+"条，失败了:"+s.data.errorTotal,duration:2e3}),console.log(s.data.errorList.length),s.data.errorList.length>0){var o=s.data.errorList,d=[];o.forEach((function(e,a){var t={goodsInfo:{goodsWeight:e.goodsWeight||"",goodsName:e.goodsName||"",packingPiece:e.packingPiece||"",remark:e.remark||""},address:{name:e.acceptMan||"",phone:e.acceptManMobile||"",provice:e.acceptProvince||"",city:e.acceptCity||"",country:e.acceptCounty||"",townName:e.acceptTown||"",detailAddress:e.acceptManAddress||""},errMsg:e.errMsg||""};d.push(t)})),a.addressDataSJ=d,console.log(a.addressDataSJ)}else setTimeout((function(){t.reset_order(),getApp().globalData.currentIndex=0,e.switchTab({url:"/pages/tabbar/inquire/index"})}),2e3);else 400==s.code&&a.$refs.ydToast.show({title:s.message})})))}),1500)):e.showToast({icon:"none",title:"请勾选快递协议"}):e.showToast({icon:"none",title:"收件信息请补充",duration:1500}):e.showToast({icon:"none",title:"请填写寄件人信息"})}},myaddress:function(a){var t={tabIndex:a};this.tabIndex=a,e.navigateTo({url:"/pages/myaddress/index?pageId=sends&data="+JSON.stringify(t)})},echoOrderData:function(){var e,a=this;try{e=JSON.parse(this.$getStorageSync("sendsOrder"))}catch(c){console.log(c)}if(e){var t=e,s=t.addressDataJJ,o=t.addressDataSJ,d=t.freight,n=t.paymentType,r=t.specEmployee,i=t.specEmployeeCode;0!=Object.keys(s).length&&(this.addressDataJJ=s),this.addressDataSJ=o,this.addressDataSJ.length>0&&a.checkDispByCity(),this.freight=d,this.payment_type=n,this.specEmployee=r,this.specEmployeeCode=i}},reset_order:function(){this.addressDataSJ=this.addressDataSJ.filter((function(e){return e.disable})),this.addressDataJJ={},this.freight="",this.payment_type="现金",this.specEmployee="",this.specEmployeeCode="",this.$setStorageSync("sendsOrder",{})},setStorageData:function(){var e={addressDataJJ:this.addressDataJJ,addressDataSJ:this.addressDataSJ,paymentType:this.payment_type};this.$setStorageSync("sendsOrder",JSON.stringify(e))}}};a.default=n}).call(this,t("543d")["default"])},"4fcc":function(e,a,t){"use strict";t.r(a);var s=t("e684"),o=t("d648");for(var d in o)"default"!==d&&function(e){t.d(a,e,(function(){return o[e]}))}(d);t("b43e");var n,r=t("f0c5"),i=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,"5928d188",null,!1,s["a"],n);a["default"]=i.exports},6385:function(e,a,t){},9098:function(e,a,t){"use strict";(function(e){t("5e56");s(t("66fd"));var a=s(t("4fcc"));function s(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(a.default)}).call(this,t("543d")["createPage"])},b43e:function(e,a,t){"use strict";var s=t("6385"),o=t.n(s);o.a},d648:function(e,a,t){"use strict";t.r(a);var s=t("2a84"),o=t.n(s);for(var d in s)"default"!==d&&function(e){t.d(a,e,(function(){return s[e]}))}(d);a["default"]=o.a},e684:function(e,a,t){"use strict";t.d(a,"b",(function(){return o})),t.d(a,"c",(function(){return d})),t.d(a,"a",(function(){return s}));var s={uniPopup:function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"e88b"))}},o=function(){var e=this,a=e.$createElement;e._self._c},d=[]}},[["9098","common/runtime","common/vendor"]]]);